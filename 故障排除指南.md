# JS Pest CRM 瀏覽器載入問題故障排除指南

## 問題描述
某些瀏覽器會卡在 Loading 畫面無法載入，但在無痕模式或其他瀏覽器中正常運作。

## 可能原因
1. **瀏覽器快取問題** - 舊的快取數據與新版本不相容
2. **localStorage 數據損壞** - 認證相關的本地存儲數據不一致
3. **Google API 初始化問題** - Google 認證 API 載入失敗
4. **網路連接問題** - Supabase 或 Google API 連接超時
5. **瀏覽器擴充功能干擾** - 廣告攔截器或其他擴充功能

## 解決方案

### 方案 1: 清除瀏覽器數據（推薦）
1. 開啟瀏覽器開發者工具 (F12)
2. 在 Console 中執行以下命令：
   ```javascript
   localStorage.clear();
   sessionStorage.clear();
   location.reload();
   ```
3. 或者使用應用程式內建的清除功能（載入畫面會顯示清除按鈕）

### 方案 2: 手動清除瀏覽器快取
#### Chrome/Edge:
1. 按 `Ctrl+Shift+Delete` (Windows) 或 `Cmd+Shift+Delete` (Mac)
2. 選擇「所有時間」
3. 勾選「快取圖片和檔案」、「Cookie 和其他網站資料」
4. 點擊「清除資料」

#### Safari:
1. 按 `Cmd+Option+E` 清空快取
2. 或到「開發」>「清空快取」

#### Firefox:
1. 按 `Ctrl+Shift+Delete`
2. 選擇要清除的項目
3. 點擊「立即清除」

### 方案 3: 停用瀏覽器擴充功能
1. 暫時停用所有瀏覽器擴充功能
2. 重新載入頁面
3. 如果問題解決，逐一啟用擴充功能找出問題來源

### 方案 4: 檢查網路連接
1. 確認網路連接正常
2. 嘗試訪問其他網站確認網路狀態
3. 如果使用公司網路，檢查是否有防火牆限制

### 方案 5: 使用診斷工具
1. 開啟瀏覽器開發者工具 (F12)
2. 在 Console 中貼上並執行診斷腳本：
   ```javascript
   // 複製 src/debug.js 中的內容
   ```

## 預防措施
1. **定期清除快取** - 建議每週清除一次瀏覽器快取
2. **使用最新版本瀏覽器** - 確保瀏覽器版本是最新的
3. **避免同時開啟多個分頁** - 減少記憶體使用量
4. **檢查擴充功能** - 定期檢查並移除不需要的擴充功能

## 技術細節

### 載入流程
1. React 應用程式初始化
2. AuthContext 初始化
3. 檢查 Supabase 會話
4. 初始化 Google API（如果配置）
5. 載入用戶數據
6. 渲染主要應用程式

### 常見錯誤訊息
- `Authentication timed out` - 認證超時，通常是網路問題
- `Essential user data missing` - localStorage 數據不完整
- `Google Auth initialization failed` - Google API 載入失敗

### 日誌檢查
開啟開發者工具的 Console 分頁，查看是否有錯誤訊息：
- 紅色錯誤訊息表示嚴重問題
- 黃色警告訊息表示潛在問題
- 藍色訊息是除錯資訊

## 聯絡支援
如果以上方案都無法解決問題，請提供以下資訊：
1. 瀏覽器類型和版本
2. 作業系統
3. 錯誤訊息截圖
4. Console 中的錯誤日誌
5. 網路環境（家用/公司/行動網路）

## 更新記錄
- 2024-12-15: 新增改善的載入畫面和錯誤處理
- 2024-12-15: 增加 localStorage 數據驗證和自動修復
- 2024-12-15: 延長認證超時時間至 10 秒
- 2024-12-15: 改善 Google API 初始化流程